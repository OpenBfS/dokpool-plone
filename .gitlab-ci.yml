before_script:
  - cd Plone
  - mkdir -p buildout-cache/eggs
  - mkdir -p buildout-cache/downloads
  - /usr/bin/virtualenv .
  - cp config-template.cfg.tmpl config.cfg
  - ./bin/pip install -r requirements.txt
  - ./bin/buildout bootstrap
  - ./bin/buildout -N -t 3 -c test_ci_server.cfg
#check:
#  script:
#    - pre-commit install
#    - pre-commit run --all-files
test:
  script:
# Stage test
    - ./bin/coverage erase
    - ./bin/coverage run -p --source=src bin/test || exit 1
    - ./bin/coverage combine
    - ./bin/coverage html
    - ./bin/coverage report
# Tests only docpool_setup (without robot)
    - ./bin/test -t test_demo_setup --all
