(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{288:function(e,t){!function(e){"use strict";void 0===window.collectivegeo&&(window.collectivegeo={});var t,o=window.collectivegeo;o.MapWidget=function(t,o){var n=e(t).data();this.mapid=e(t).attr("id"),this.map=null,this.edit_layer=null,this.trigger=t,this.settings=o,o.center||void 0===n.cgeolongitude||void 0===n.cgeolatitude||(o.center=new OpenLayers.LonLat(n.cgeolongitude,n.cgeolatitude)),o.zoom||void 0===n.cgeozoom||(o.zoom=n.cgeozoom),o.lang||void 0===n.cgeolang||(o.lang=n.cgeolang),this.initMap()},o.MapWidget.prototype={initMap:function(){this.map=new OpenLayers.Map(this.mapid,this.getDefaultOptions()),this.settings.lang&&OpenLayers.Lang.setCode(this.settings.lang),e(window).trigger("mapload",this),0===this.map.layers.length&&this.addLayers(this.getDefaultLayers()),this.settings.center&&this.settings.zoom?this.setCenter(this.settings.center,this.settings.zoom):this.map.zoomToExtent(),e(window).trigger("maploadend",this)},setCenter:function(e,t){var o=this.map.displayProjection;o&&e.transform(o,this.map.getProjectionObject()),this.map.setCenter(e,t)},addLayers:function(e,t){var o;if(t&&this.mapid!==t)return null;for(o=0;o<e.length;o+=1)this.map.addLayer(e[o]())},getDefaultLayers:function(){var e=this;return[function(){return new OpenLayers.Layer.TMS("Base layer","http://tile.openstreetmap.org/",{type:"png",getURL:e.osmGetTileURL,transitionEffect:"resize",displayOutsideMaxExtent:!0,numZoomLevels:19,attribution:'<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'})}]},getDefaultOptions:function(){return e.extend({theme:null,projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",numZoomLevels:19,ImgPath:"++plone++openlayers.static/openlayers/img",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),controls:[new OpenLayers.Control.ArgParser,new OpenLayers.Control.Attribution,new OpenLayers.Control.LayerSwitcher({roundedCorner:!1}),new OpenLayers.Control.Navigation({zoomWheelEnabled:!1,dragPanOptions:{enableKinetic:!0}}),new OpenLayers.Control.Zoom]},this.settings.map_defaults)},osmGetTileURL:function(e){var t=this.map.getResolution(),o=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),n=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),a=this.map.getZoom()+this.zoomOffset,i=Math.pow(2,a);return n<0||n>=i?OpenLayers.Util.getImagesLocation()+"blank.gif":(o=(o%i+i)%i,this.url+a+"/"+o+"/"+n+"."+this.type)},addGeocoder:function(){var t=this,o=e("#"+t.mapid+"-geocoder"),n=o.find("input"),a=o.find("button");a.click((function(e){t.retrieveLocation(o,n.val()),e.preventDefault()})),n.keypress((function(e){if(13===e.keyCode)return e.preventDefault(),a.click(),null}))},retrieveLocation:function(t,o){var n,a,i,r=this,s=e(r.trigger).data("geocoderurl"),l=t.find(".results"),d=l.find("ul"),p=t.find(".fieldErrorBox"),c=(t.find("input").offset(),function(e){var t=e.data.latlon;r.setCoordinates(t[1],t[0]),e.data.results.hide(),e.preventDefault()});d.empty(),e.getJSON(s,{address:o},(function(o){if(null===o)p.show(),l.hide(),t.addClass("error");else{for(t.removeClass("error"),p.hide(),i=0;i<o.length;i+=1)(n=e("<a>").append(o[i][0])).bind("click",{latlon:o[i][1],results:l},c),(a=e("<li>")).append(n),d.append(a);l.show()}}))},setCoordinates:function(e,t){var o=new OpenLayers.Geometry.Point(e,t);o.transform(this.map.displayProjection,this.map.getProjectionObject()),this.setCenter(new OpenLayers.LonLat(e,t),10),this.wkt_input&&this.wkt_input.val(o.toString()),this.lonid&&this.latid&&this.zoomid&&(this.zoomid.val(10),this.lonid.val(e),this.latid.val(t)),this.edit_layer&&this.edit_layer.addFeatures([new OpenLayers.Feature.Vector(o)])}},OpenLayers.Control.WKTEditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e,t){var o,n,a,i=[new OpenLayers.Control.Navigation,new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"}),new OpenLayers.Control.ModifyFeature(e,{mode:OpenLayers.Control.ModifyFeature.RESHAPE||OpenLayers.Control.ModifyFeature.DRAG})];OpenLayers.Control.Panel.prototype.initialize.apply(this,[t]),this.addControls(i),this.defaultControl=this.controls[5],this.wkt_input.length>0&&(o=this.wkt_input.val(),n={internalProjection:e.map.getProjectionObject(),externalProjection:e.map.displayProjection},(a=new OpenLayers.Format.WKT(n).read(o))&&(e.addFeatures([a]),e.map.zoomToExtent(e.getDataExtent()))),e.events.register("featureadded",this,this.updateWKTWidget),e.events.register("featuremodified",this,this.updateWKTWidget),e.events.register("beforefeaturesadded",this,(function(e){e.object.destroyFeatures()}))},updateWKTWidget:function(e){var t={internalProjection:e.object.map.getProjectionObject(),externalProjection:e.object.map.displayProjection},o=new OpenLayers.Format.WKT(t);this.wkt_input.length>0&&this.wkt_input.val(o.write(e.feature)),o.destroy()},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Control.MarkerEditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e,t){OpenLayers.Control.Panel.prototype.initialize.apply(this,[t]);var o,n=[new OpenLayers.Control.Navigation,new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.ModifyFeature(e)];this.addControls(n),this.defaultControl=this.controls[0],this.lonid.length>0&&this.latid.length>0&&(o=new OpenLayers.Geometry.Point(this.lonid.val(),this.latid.val()),e.map.displayProjection&&o.transform(e.map.displayProjection,e.map.getProjectionObject()),e.addFeatures([new OpenLayers.Feature.Vector(o)]),e.events.register("featureadded",this,this.updateForm),e.events.register("featuremodified",this,this.updateForm)),this.zoomid.length>0&&e.map.events.register("zoomend",this,this.updateZoom),e.events.register("beforefeaturesadded",this,(function(e){e.object.destroyFeatures()}))},updateZoom:function(e){this.zoomid.val(e.object.getZoom())},updateForm:function(e){var t=new OpenLayers.LonLat(e.feature.geometry.x,e.feature.geometry.y);e.object.map.displayProjection&&t.transform(e.object.map.getProjectionObject(),e.object.map.displayProjection),this.lonid.val(t.lon),this.latid.val(t.lat)},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),t={init:function(t){return this.each((function(){var n,a=e.extend(!0,{imgpath:"/",center:null,zoom:null},t),i=e(this);i.data("collectivegeo")||(n=new o.MapWidget(this,a),e(this).data("collectivegeo",{target:i,mapwidget:n}))}))},destroy:function(){return this.each((function(){var t=e(this),o=t.data("collectivegeo");o&&(o.collectivegeo.remove(),t.removeData("collectivegeo"))}))},add_layers:function(t){return this.each((function(){var o=e(this).data("collectivegeo");o&&o.mapwidget.addLayers(t)}))},refresh:function(t){return this.each((function(){var t=e(this).data("collectivegeo");t&&t.mapwidget.map.updateSize()}))},add_edit_layer:function(t){return this.each((function(){var o,n,a,i=e(this).data("collectivegeo");i&&(i.mapwidget.wkt_input=t?e("#"+t):e(i.mapwidget.trigger).parent().find("textarea"),o=i.mapwidget.map,n=new OpenLayers.Layer.Vector("Edit"),o.addLayer(n),i.mapwidget.edit_layer=n,a=new OpenLayers.Control.WKTEditingToolbar(n,{wkt_input:i.mapwidget.wkt_input}),o.addControl(a),a.activate())}))},add_markeredit_layer:function(t,o,n){return this.each((function(){var a,i,r,s,l=e(this).data("collectivegeo");l&&(t&&o&&n||(i=l.mapwidget.mapid,t=i+"-lon",o=i+"-lat",n=i+"-zoom"),l.mapwidget.lonid=e("#"+t),l.mapwidget.latid=e("#"+o),l.mapwidget.zoomid=e("#"+n),a=l.mapwidget.map,r=new OpenLayers.Layer.Vector("Marker",{renderOptions:{yOrdering:!0}}),a.addLayer(r),l.mapwidget.edit_layer=r,s=new OpenLayers.Control.MarkerEditingToolbar(r,{lonid:l.mapwidget.lonid,latid:l.mapwidget.latid,zoomid:l.mapwidget.zoomid}),a.addControl(s),s.activate(),l.mapwidget.setCenter(new OpenLayers.LonLat(e("#"+t).val(),e("#"+o).val()),e("#"+n).val()))}))},add_geocoder:function(){return this.each((function(){var t=e(this).data("collectivegeo");t&&t.mapwidget.addGeocoder()}))}},e.fn.extend({collectivegeo:function(o){return t[o]?t[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void e.error("Method "+o+" does not exist on jQuery.collectivegeo"):t.init.apply(this,arguments)}})}(jQuery)}}]);