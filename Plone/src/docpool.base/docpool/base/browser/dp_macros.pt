<html xmlns:tal="http://xml.zope.org/namespaces/tal" 
     xmlns:metal="http://xml.zope.org/namespaces/metal" 
     i18n:domain="docpool.base">
    <body>
       
        <metal:listingmacro define-macro="listing">
        <tal:results define="b_start python:request.get('b_start', 0);
                             batch python:view.getFolderContents({'sort_on':'mdate','sort_order':'reverse'});
                             site_properties context/portal_properties/site_properties;
                             use_view_action site_properties/typesUseViewActionInListings|python:();
                             isAnon context/@@plone_portal_state/anonymous;
                             normalizeString nocall: context/plone_utils/normalizeString;
                             toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                             show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
                             navigation_root_url context/@@plone_portal_state/navigation_root_url;
                             pas_member context/@@pas_member;
                             buttons python:view.dp_buttons(batch)">
        <tal:listing>
        
          <form name="folderContentsForm"
                method="post"
                action="folder_object"
                tal:attributes="action context/absolute_url"
                class="kssattr-serveraction-foldercontents_update_table">
            <input tal:replace="structure context/@@authenticator/authenticator" />
            <input type="hidden" name="orig_template" value="view"/>
        
          <tal:loop tal:repeat="button buttons" tal:condition="batch">
          <input class="context" 
                 type="submit"
                 name=""
                 value=""
                 i18n:attributes="value"
                 tal:attributes="value button/title; name button/url; class button/cssclass|nothing">
          </tal:loop>

          <table id="sortable"
                 class="elanlisting"
                 summary="Content listing"
                 tal:condition="batch"
                 i18n:attributes="summary summary_content_listing;"
                 tal:define="isOverview python:0">
            <thead>
              <metal:block tal:condition="batch|not:standalone|nothing">
                <tr>
                  <metal:header_slot metal:define-slot="listingheader">
                    <th class="nosort" tal:condition="buttons"></th>
                    <th class="nosort"><i18n:txt translate="">Category/Dates</i18n:txt><br><i18n:txt translate="">Description</i18n:txt></th>
                    <th class="nosort" i18n:translate="">Main Text</th>
                    <th class="nosort"></th>      
                 </metal:header_slot>
                </tr>
              </metal:block>
            </thead>

            <tbody >
                <tal:items tal:repeat="edoc batch">
                   <tr tal:define="oddrow  repeat/edoc/odd;
                                   item_id edoc/id|edoc/getId;
                                   item_title edoc/Title|edoc/title_or_id;
                                   title_or_id python:item_title or item_id;
                                   item_obj edoc/getObject|nothing"
                       tal:attributes="class python:oddrow and 'notDraggable  even' or 'notDraggable odd';
                                       id item_id;" >
                     
                           <metal:block define-slot="entry">
                            <tal:if condition="nocall:item_obj">
                            <td tal:condition="buttons">
                <input type="checkbox"
                       class="noborder"
                       name="paths:list" id="#"
                       value="#"
                       alt=""
                       title=""
                       tal:attributes="value   edoc/getPath;
                                       id      string:cb_${item_id};
                                       checked nothing" />
                <input type="hidden" name="selected_obj_paths:list" value="#"
                       tal:attributes="value edoc/getPath" />
                <label tal:content="title_or_id"
                       tal:attributes="for string:cb_${item_id}" 
                       class="hiddenStructure">
                  Item Title
                </label>
                            
                            </td>
                            <tal:insertview replace="structure python:item_obj.restrictedTraverse('@@listitem')(edoc=edoc,isOverview=isOverview,isCollection=False,myfolder=context)"/>
                           <td>
                <tal:if condition="item_obj/canBeDeleted">
                <a href="" 
                    class="link-overlay"
                    title="Delete"
                    tal:define="alert_msg python:context.translate('alert_delete_popup', default='Do you really want to delete this object?', domain='docpool.base', escape_for_js=True)"
                    tal:attributes="onclick1 string:return confirm('${title_or_id}: ${alert_msg}');
                                    href python:'%s/delete_confirmation' % item_obj.absolute_url()"
                    i18n:attributes="title"
                    ><img src="" tal:attributes="src string:${navigation_root_url}/delete_icon.gif"/> </a>
                </tal:if>
                           </td>
                           </tal:if>
                           </metal:block>
                   </tr>
                </tal:items>
            </tbody>
        </table>
        
        <tal:buttons tal:repeat="button buttons">
          <input class="context"
                 type="submit"
                 name=""
                 value=""
                 i18n:attributes="value"
                 tal:attributes="value button/title; name button/url; class button/cssclass|nothing" />
        </tal:buttons>
        </form>

        </tal:listing>
        <metal:empty metal:define-slot="no_items_in_listing">
            <p class="discreet"
               tal:condition="not: batch"
               i18n:translate="description_no_items_in_folder">
                There are currently no items in this folder.
            </p>
        </metal:empty>

        </tal:results>
        </metal:listingmacro>     
        							
    </body>
</html>
