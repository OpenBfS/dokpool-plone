<tal:block i18n:domain="docpool.base"
           define="view nocall:options/view;
                   context nocall:options/context;
                   here nocall:context">
<tal:def define="edit_allowed context/canBeEdited;
                 elanobj view/elanobject;">
    <div metal:use-macro="here/@@elan.macros/macros/elandoc"/>   
    
    <tal:if condition="python:context.uploadsAllowed() and edit_allowed">
       <script  type="text/javascript" tal:content="view/javascript">
      </script>
      <div class="elanUploaderContainer">
          <input type="hidden"
                 name="uploadUrl"
                 class="uploadUrl"
                 tal:attributes="value view/getUploadUrl" />
          <input type="hidden"
                 name="uploadData"
                 class="uploadData"
                 tal:attributes="value view/getDataForUploadUrl" />     
      </div>
      <input class="context"
                  type="submit"
                  name="form.button.save"
                  value="Finish uploads and publish"
                  tal:condition="python:context.publishedImmediately(raw=True) and not context.isIndividual()"
                  i18n:attributes="value"
                  onclick="window.location.href='content_status_modify?workflow_action=publish';return false;"
                  />
     
    </tal:if>
 </tal:def>
</tal:block>