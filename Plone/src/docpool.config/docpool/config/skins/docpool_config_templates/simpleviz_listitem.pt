<tal:block i18n:domain="docpool.base"
           define="view nocall:options/view;
                   context nocall:options/context;
                   here nocall:context">
    <tal:def define="edoc options/edoc;
                 euid edoc/UID;
                 item_id edoc/id|edoc/getId;
                 item_title edoc/Title|edoc/title_or_id;
                 title_or_id python:item_title or item_id;                 
                 buttons options/buttons|nothing;
                 edocobj edoc/getObject;
                 elanobj view/elanobject;
                 isOverview options/isOverview;
                 isCollection options/isCollection;
                 individual context/isIndividual;
                 myfolder nocall:options/myfolder;
                 item_description edoc/Description;
                 eurl edoc/getURL;
                 item_url python:isCollection and '%s/@@dview?d=%s&disable_border=1' % (myfolder.absolute_url(), euid) or edoc.getURL(original=True);
                 item_url python:isOverview and eurl or item_url;
                 item_modified edoc/getMdate;
                 item_created edoc/CreationDate;
                 item_creator edoc/Creator;
                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                 pas_member context/@@pas_member;
                 author python:pas_member.info(item_creator);
                 creator_fullname author/name_or_id;
                 item_ptype edoc/portal_type;
                 normalizeString nocall: context/plone_utils/normalizeString;
                 item_type_class python:'contenttype-' + normalizeString(item_ptype);
                 rs edoc/review_state;
                 item_wf_state_class python:'state-' + normalizeString(rs);              
                 navigation_root_url context/@@plone_portal_state/navigation_root_url;
                 ">
                <td class="actions" tal:condition="python:not isOverview and not isCollection">
                    <div metal:use-macro="here/@@dp.macros/macros/cb"/> 
                    <div metal:use-macro="here/@@dp.macros/macros/delete"/> 
                    <div metal:use-macro="here/@@dp.macros/macros/docactions"/>
                </td>
                <td class="title">
                    <div metal:use-macro="here/@@dp.macros/macros/doccontent"/> 
                    <span tal:condition="python:(context.getMapImageObj != None) and (context.getLegendImageObj() != None)">
  		       <div class="map">
                         <tal:insert replace="structure python:context.getMapImage(scale='/@@images/image/thumb')" />
		       </div>
                    </span>
                    <span tal:condition="python:((context.getMapImageObj() == None) or (context.getLegendImageObj() == None))">
                       <div class="images" tal:define="images python:context.getImages()" tal:condition="images">
                          <div tal:repeat="b images" class="image">
                             <img tal:attributes="src python:'/'.join(b.getPhysicalPath()) + '/@@images/image/thumb'">
                          </div>
                       </div>
                    </span>
                    <span tal:condition="python:context.getFiles()">
                      <div class="pdflink" tal:define="pdf python:context.getFiles()[0]" tal:condition="nocall:pdf">
                         <span tal:condition="python:((context.getMapImageObj() != None) or (context.getLegendImageObj() != None))">
                             <br><a href="${pdf/absolute_url}" target="_blank" i18n:domain="docpool.config" i18n:translate="">Printable version</a>
                         </span>
                         <span tal:condition="python:((context.getMapImageObj() == None) or (context.getLegendImageObj() == None))">
                             <a href="${pdf/absolute_url}" target="_blank" i18n:domain="docpool.config"><span tal:content="python:pdf.Title()"/></a>
                         </span>
                      </div>
                    </span>
                </td>
                <td class="metadata">
                    <div metal:use-macro="here/@@dp.macros/macros/doc_meta_listitem"/>
                </td>
    </tal:def> 
</tal:block>
