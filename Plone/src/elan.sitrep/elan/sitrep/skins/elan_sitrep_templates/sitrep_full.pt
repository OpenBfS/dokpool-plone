<tal:block i18n:domain="elan.sitrep"
           define="view nocall:options/view;
                   context nocall:options/context;
                   here nocall:context">
<tal:def define="edit_allowed context/canBeEdited;
                 elanobj view/elanobject;
                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                 rs context/myState;">

<tal:if condition="python:rs=='private'">
   <div class="formControls publish" tal:condition="edit_allowed">
   <tal:def define="missingModules context/missingModules">
       <tal:missing condition="missingModules">
       <h4 i18n:translate="">Module types missing (preventing publication)</h4>
       <ul>
        <li tal:repeat="mt missingModules">${mt}</li>
       </ul>
       </tal:missing>
	   <a id="form-buttons-publish" 
	       tal:condition="not:missingModules"
	       onclick="return confirm('${context/Title}: ${alert_msg}');"
	      tal:define="alert_msg python:context.translate('report_publish_popup', default='Do you really want to create a published version of this report?', domain='elan.sitrep', escape_for_js=True)"
	   class="submit-widget button-field context" tal:attributes="href string:${context/absolute_url}/publishReport" i18n:translate="">Publish</a>
	   <a id="form-buttons-create" 
	       onclick="return confirm('${context/Title}: ${alert_msg}');"
	      tal:define="alert_msg python:context.translate('report_mirror_popup', default='Do you really want to define this report based on the current overview?', domain='elan.sitrep', escape_for_js=True)"
	   class="submit-widget button-field context" tal:attributes="href string:${context/absolute_url}/mirrorOverview" i18n:translate="">Mirror Overview</a>
   </tal:def>
   </div>
</tal:if>
<tal:if condition="python:rs=='published'">
        <div class="pdflink" tal:define="pdf context/getRepresentativePDF" tal:condition="nocall:pdf">
            <a href="${pdf/absolute_url}" target="_blank" i18n:domain="elan.sitrep" i18n:translate="">Printable version</a>
        </div>
</tal:if>
          <div metal:use-macro="here/@@dp.macros/macros/content_metadata"/>
          <tal:insertview replace="structure python:context.restrictedTraverse('@@meta')()"/>

          <tal:if condition="htmltext" define="htmltext python: context.text and context.text.output or ''">
<!--           <h3 i18n:translate="">Summary</h3>  -->
          <span tal:attributes="id string:html_${context/getId}" tal:content="structure htmltext" />
          </tal:if>
          
          <tal:loop repeat="m context/myModules">
<!--          <h3><tal:var replace="repeat/m/number"/> <tal:var replace="m/Title" /></h3>  -->
          <tal:if condition="htmltext" define="htmltext python: m.text and m.text.output or ''">
          <span tal:attributes="id string:mod_${m/getId}" tal:content="structure htmltext" />
          </tal:if>
          </tal:loop>
    
 </tal:def>
</tal:block>
