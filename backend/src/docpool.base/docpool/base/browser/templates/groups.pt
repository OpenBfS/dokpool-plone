<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      xml:lang="en"
      i18n:domain="docpool.base"
>
  <body>

    <metal:content-core fill-slot="main">

      <h1>Groups Listing on
        <span tal:replace="python: context.title"></span></h1>

      <style type="text/css">
        .tableFixHead          { overflow: auto; height: 100px; }
        .tableFixHead thead th { position: sticky; top: 0; z-index: 1; }
      </style>

      <table class="tableFixHead table table-striped table-sm">
        <thead>
          <tr>
            <th i18n:translate="groups_name">Name</th>
            <!-- <th i18n:translate="groups_source">Source</th> -->
            <th i18n:translate="groups_members">Members</th>
            <th i18n:translate="groups_member_groups">Member in groups</th>
            <th i18n:translate="groups_global_roles">Global roles</th>
            <th i18n:translate="groups_local_roles">Local roles</th>
          </tr>
        </thead>

        <tbody>
          <tr tal:repeat="group python:view.get_groups()">
            <td>
              <a name="${group/id}"></a>
              <span tal:replace="group/title"></span>
              <a href=""
                 target="_blank"
                 tal:attributes="
                   href python:portal_url + '/@@usergroup-groupprefs?searchstring=' + group['id'];
                 "
              >
                <tal:icon tal:replace="structure python:icons.tag('search')" /></a>

              <a href=""
                 target="_blank"
                 tal:attributes="
                   href python:portal_url + '/@@usergroup-groupmembership?groupname=' + group['id'];
                 "
              >
                <tal:icon tal:replace="structure python:icons.tag('pencil')" /></a>
              <br /><span i18n:translate="groups_group_id">(<span tal:content="group/id"
                      i18n:name="group_id"
                >Group ID</span>)</span>
            </td>
            <!-- <td tal:content="python: 'LDAP' if group['ldap'] else 'Plone'"></td> -->
            <td>
              <ul class="list-unstyled">
                <li tal:repeat="memberuser python:group['users']">
                  <tal:icon tal:replace="structure python:icons.tag('person-fill')" />
                  <a href=""
                     target="_blank"
                     tal:content="memberuser"
                     tal:attributes="
                       href python:portal_url + '/@@usergroup-userprefs?searchstring=' + memberuser;
                     "
                  >
                  </a>
                </li>
                <li tal:repeat="membergroup python:group['groups']">
                  <tal:icon tal:replace="structure python:icons.tag('people-fill')" />
                  <a href=""
                     target="_blank"
                     tal:content="membergroup"
                     tal:attributes="
                       href python:portal_url + '/@@usergroup-groupmembership?groupname=' + membergroup;
                     "
                  >
                  </a>
                  <a href=""
                     tal:attributes="
                       href python:'#' + membergroup;
                     "
                  >
                    <tal:icon tal:replace="structure python:icons.tag('arrow-down')" />
                  </a>
                </li>
                <li tal:condition="python: group['groups']">
                  <tal:icon tal:replace="structure python:icons.tag('eye')" />
                  <a class="pat-plone-modal"
                     tal:attributes="
                       href python:portal_url + '/@@group_members_flattened?groupname=' + group['id'];
                     "
                  >
                    <span i18n:translate="groups_all_members">All members</span>
                  </a>
                </li>
              </ul>
            </td>
            <td>
              <ul class="list-unstyled">
                <li tal:repeat="group_id python:group['member_in']">
                  <a href=""
                     target="_blank"
                     tal:content="python:group_id"
                     tal:attributes="
                       href python:portal_url + '/@@usergroup-groupmembership?groupname=' + group_id;
                     "
                  >
                  </a>
                  <a href=""
                     tal:attributes="
                       href python:'#' + group_id;
                     "
                  >
                    <tal:icon tal:replace="structure python:icons.tag('arrow-down')" />
                  </a>
                </li>
              </ul>
            </td>
            <td>
              <ul class="list-unstyled">
                <li tal:repeat="role python:group['roles']"
                    tal:content="role"
                ></li>
              </ul>
            </td>
            <td>
              <ul class="list-unstyled">
                <li tal:repeat="role python:group['local_roles']"
                    tal:content="role"
                ></li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>


    </metal:content-core>

  </body>
</html>
